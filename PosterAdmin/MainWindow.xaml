<Window x:Class="PosterAdmin.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:viewModels="clr-namespace:PosterAdmin.ViewModels"
        mc:Ignorable="d"
        Title="PosterAdmin - .NET 9.0 WPF 앱" 
        Height="700" Width="1000"
        MinHeight="500" MinWidth="700"
        WindowStartupLocation="CenterScreen"
        Style="{StaticResource MaterialDesignWindow}">

    <Window.DataContext>
        <viewModels:MainViewModel />
    </Window.DataContext>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- 헤더 영역 -->
        <materialDesign:Card Grid.Row="0" Padding="20" Margin="0,0,0,10" materialDesign:ElevationAssist.Elevation="Dp4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="PosterAdmin" 
                               Style="{StaticResource MaterialDesignHeadline4TextBlock}"
                               Foreground="{DynamicResource MaterialDesignBody}" />
                    <TextBlock Text=".NET 9.0 WPF + Material Design + LiteDB" 
                               Style="{StaticResource MaterialDesignBody2TextBlock}"
                               Foreground="{DynamicResource MaterialDesignBodyLight}" />
                </StackPanel>

                <materialDesign:Chip Grid.Column="1"
                                     Content="{Binding TotalItemCount, StringFormat='총 {0}개 아이템'}"
                                     VerticalAlignment="Center"
                                     Background="{DynamicResource MaterialDesignPaper}"
                                     Foreground="{DynamicResource MaterialDesignBody}" />
            </Grid>
        </materialDesign:Card>

        <!-- 입력 및 검색 영역 -->
        <materialDesign:Card Grid.Row="1" Padding="20" Margin="0,10,0,0" materialDesign:ElevationAssist.Elevation="Dp2">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- 새 아이템 추가 -->
                <materialDesign:Card Grid.Row="0" Padding="16" Margin="0,0,0,16" Background="{DynamicResource MaterialDesignCardBackground}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="새 아이템 추가" 
                                   Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                                   Margin="0,0,0,16" />

                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="3*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBox Grid.Column="0"
                                     Text="{Binding NewItemName, UpdateSourceTrigger=PropertyChanged}"
                                     Margin="0,0,8,0"
                                     materialDesign:HintAssist.Hint="아이템 이름"
                                     Style="{StaticResource MaterialDesignFilledTextBox}">
                                <TextBox.InputBindings>
                                    <KeyBinding Key="Enter" Command="{Binding AddItemCommand}" />
                                </TextBox.InputBindings>
                            </TextBox>

                            <TextBox Grid.Column="1"
                                     Text="{Binding NewItemDescription, UpdateSourceTrigger=PropertyChanged}"
                                     Margin="8,0,8,0"
                                     materialDesign:HintAssist.Hint="아이템 설명"
                                     Style="{StaticResource MaterialDesignFilledTextBox}">
                                <TextBox.InputBindings>
                                    <KeyBinding Key="Enter" Command="{Binding AddItemCommand}" />
                                </TextBox.InputBindings>
                            </TextBox>

                            <Button Grid.Column="2"
                                    Command="{Binding AddItemCommand}"
                                    Content="추가"
                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                    Margin="8,0,0,0"
                                    Height="40" />
                        </Grid>
                    </Grid>
                </materialDesign:Card>

                <!-- 검색 및 작업 버튼 -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- 검색 영역 -->
                    <Grid Grid.Column="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBox Grid.Column="0"
                                 Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,0,8,0"
                                 materialDesign:HintAssist.Hint="검색어 입력"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}">
                            <TextBox.InputBindings>
                                <KeyBinding Key="Enter" Command="{Binding SearchCommand}" />
                            </TextBox.InputBindings>
                        </TextBox>

                        <Button Grid.Column="1"
                                Command="{Binding SearchCommand}"
                                Content="검색"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Height="40" />
                    </Grid>

                    <!-- 작업 버튼들 -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="16,0,0,0">
                        <Button Command="{Binding RefreshItemsCommand}"
                                Content="새로고침"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Margin="0,0,8,0"
                                Height="40" />

                        <Button Command="{Binding ClearAllDataCommand}"
                                Content="전체삭제"
                                Style="{StaticResource MaterialDesignRaisedSecondaryButton}"
                                Height="40" />
                    </StackPanel>
                </Grid>
            </Grid>
        </materialDesign:Card>

        <!-- 데이터 그리드 영역 -->
        <materialDesign:Card Grid.Row="2" Padding="0" Margin="0,10,0,0" materialDesign:ElevationAssist.Elevation="Dp2">
            <Grid>
                <DataGrid ItemsSource="{Binding Items}"
                          SelectedItem="{Binding SelectedItem}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          IsReadOnly="True"
                          GridLinesVisibility="Horizontal"
                          HeadersVisibility="Column"
                          SelectionMode="Single"
                          materialDesign:DataGridAssist.CellPadding="8"
                          materialDesign:DataGridAssist.ColumnHeaderPadding="8">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" 
                                            Binding="{Binding DisplayId}" 
                                            Width="80" />
                        
                        <DataGridTextColumn Header="이름" 
                                            Binding="{Binding Name}" 
                                            Width="200" />
                        
                        <DataGridTextColumn Header="설명" 
                                            Binding="{Binding Description}" 
                                            Width="*" />
                        
                        <DataGridTextColumn Header="생성일시" 
                                            Binding="{Binding CreatedAt, StringFormat='yyyy-MM-dd HH:mm:ss'}" 
                                            Width="150" />
                        
                        <DataGridCheckBoxColumn Header="활성화" 
                                                Binding="{Binding IsActive, UpdateSourceTrigger=PropertyChanged}" 
                                                Width="80">
                            <DataGridCheckBoxColumn.ElementStyle>
                                <Style TargetType="CheckBox">
                                    <EventSetter Event="Checked" Handler="CheckBox_CheckChanged"/>
                                    <EventSetter Event="Unchecked" Handler="CheckBox_CheckChanged"/>
                                </Style>
                            </DataGridCheckBoxColumn.ElementStyle>
                        </DataGridCheckBoxColumn>
                        
                        <DataGridTemplateColumn Header="작업" Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Command="{Binding DataContext.DeleteItemCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}"
                                            Content="삭제"
                                            Style="{StaticResource MaterialDesignFlatSecondaryButton}"
                                            Height="32" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- 로딩 인디케이터 -->
                <materialDesign:Card VerticalAlignment="Center" 
                                     HorizontalAlignment="Center"
                                     Padding="24"
                                     materialDesign:ElevationAssist.Elevation="Dp8"
                                     Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Loading" 
                                                 Width="24" Height="24"
                                                 Margin="0,0,8,0"
                                                 VerticalAlignment="Center" />
                        <TextBlock Text="데이터 처리 중..." 
                                   Style="{StaticResource MaterialDesignBody2TextBlock}"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                </materialDesign:Card>
            </Grid>
        </materialDesign:Card>

        <!-- 상태바 -->
        <materialDesign:Card Grid.Row="3" Padding="16" Margin="0,10,0,0" materialDesign:ElevationAssist.Elevation="Dp1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="{Binding StatusMessage}" 
                           Style="{StaticResource MaterialDesignBody2TextBlock}"
                           VerticalAlignment="Center" />

                <materialDesign:Chip Grid.Column="1"
                                     Content=".NET 9.0 + Material Design + LiteDB"
                                     VerticalAlignment="Center"
                                     Background="{DynamicResource MaterialDesignChipBackground}"
                                     Foreground="{DynamicResource MaterialDesignBody}" />
            </Grid>
        </materialDesign:Card>
    </Grid>
</Window>
